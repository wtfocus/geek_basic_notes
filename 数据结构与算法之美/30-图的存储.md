[TOC]

## 30 | 图的表示：如何存储微博、微信等社交网络中的好友关系？

1.  开篇题
    -   如何**存储**微博、微信这些社交网络的好友关系吗？

### 概念

-   **顶点（vertex）**
    -   图中的元素
-   **边（edge）**
    -   一个顶点与任意顶点建立的关系
-   **度（degree）**
    -   跟顶点相连接的边的条数。
-   **有向图**
    -   **入度（in-degree）**
        -   有多少条边指向这个顶点的。
    -   **出度（out-degree）**
        -   有多少条边是以这个顶点为起点指向其他顶点的。
-   **无向图**
-   **带权图（weighted graph）**
    -   每条边都有一个权重（weight）。
    -   ![img](imgs/55d7e4806dc47950ae098d959b03ace8-7122893.jpg)

### 邻接矩阵 

1.  图**最直观**的一种存储方法。
2.  实现原理
    -   邻接矩阵的底层依赖一个**二维数组**。
    -   ![img](https://static001.geekbang.org/resource/image/62/d2/625e7493b5470e774b5aa91fb4fdb9d2.jpg)
3.  分析

    -   缺点
        -   **浪费存储空间**
    -   优点
        -   邻接矩阵的存储方式**简单、直观**，因为基于数组（随机访问ß），所以在获取两个顶点的关系时，就非常**高效**。
        -   **方便计算**
            -   可以将很多的图运算转换成**矩阵运算**。

### 邻接表

1.  实现原理

    -   每个顶点对应一条链表，链表中存储的是与这个顶点相连接的其他顶点。

    -   ![img](imgs/039bc254b97bd11670cdc4bf2a8e1394-7123389.jpg)

2.  分析

    -   优点
        -   **节省存储空间**
    -   缺点
        -   链表访问对 cpu 缓存不友好
### 解答开篇

1.  开篇题
    
	-   如何存储微博、微信等社交网络的好友关系？
    
2.  解决方案
    -   **邻接表中存储了用户的关注关系**
    -   **逆邻接表中存储的是用户的被关注关系**
    -   ![img](imgs/501440bcffdcf4e6f9a5ca1117e990a1-7123631.jpg)
    
3.  如何快速判断两个用户是否是关注与被关注的关系

    -   我们需要将邻接表中的链表改为**支持快速查找**的动态数据结构。

    -   需要支持的操作

        -   按照用户名称的首字母排序
        -   分页来获取用户的粉丝列表或关注列表

    -   我们选择用**跳表**这种结构
        >   跳表插入、删除、查找都非常高效。时间复杂度都是 O(logn)，空间复杂度稍高，是 O(n)。
        >
        >   最重要一点，跳表中存储的数据本来就是有序的了，分页获取粉丝列表或关注列表，就非常高效。

4.  如果**数据规模太大**，像微博那样有上亿用户，我们就无法存储在内存中了，这个时候该怎么办呢？
    1.  通过哈希算法等**数据分片**方式，将邻接表存储在不同的机器上。
        -   ![img](imgs/08e4f4330a1d88e9fec94b0f2d1bbe2f-7123984.jpg)
    2.  利用**外部存储**（如：硬盘、数据库）

