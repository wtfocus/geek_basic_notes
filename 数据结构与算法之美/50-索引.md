[TOC]

## 50 | 索引：如何在海量数据中快速查找某个数据？

### 为什么需要索引


1. 对于**存储**的需求，功能上无外乎增删改查。
    - “**如何节省存储空间、如何提高数据增删改查的执行效率**”，就成了设计的重点。
    - 而这些系统的实现都离不开一个东西 -- **索引**。索引设计的好坏，直接决定了这些系统是否优秀。

### 索引的需求定义

- 一般可以从**功能性需求**和非功能性需求两方面来分析

#### 功能性需求

1. **数据是格式化数据还是非格式化数据？**
    - 结构化数据
        - 如 MySQL 中的数据
    - 非结构化数据
        - 搜索引擎中的网页
        - 一般需要做预处理，提取查询关键词，对关键词构建索引
2. **数据是静态数据还是动态数据？**
    - 静态数据
        - 在构建索引时，只需要考虑查询效率就可以了。
    - 动态数据
        - 不仅要考虑索引的查询效率，还需要支持动态数据集合的索引。
3. **索引存储在内存还是硬盘？**
    - 内存
        - 速度快，
        - 空间有限
    - 硬盘
    - 一部分存储在内存，一部分存储在硬盘
        - 兼顾内存消耗和查询效率
4. **单值查找还是区间查找？**
5. **单关键词查找还是多关键词组合查找？**

#### 非功能性需求

1. **不管是存储在内存中还是磁盘中，索引对存储空间的消耗不能过大**
    - 有时候，索引对存储空间的消耗会超过原始数据。
2. **考虑索引查询效率的同时，我们还需要考虑索引的维护成本**
    - 在原始数据动态增删改的同时，我们也需要动态的更新索引。而索引的更新势必会影响到增删改操作的性能。

### 构建索引常用的数据结构有哪些？

1. 支持**动态数据集合**的数据结构。
    1. **散列表**
        - 增删改查操作的性能非常好，时间复杂度是 O(1)。
        - 案例：一些键值数据库，如 Redis、Memcache
        - 这类索引，一般都构建在内存中。
    2. **红黑树**
        - 一种常用的平衡二叉树
        - 数据插入、删除、查找的时间复杂度是 O(logn)，非常适用来用构建内存索引。
        - 案例：Ext 文件系统中，对磁盘块的索引，用的就是红黑树。
    3. **B+ 树**
        - 比起红黑树，更加适合构建存储在磁盘中的索引。
        - B+ 是一个多叉树，对相同个数的数据构建索引，B+ 树的高度要低于红黑树。当借助索引查询数据的时候，读取 B+ 树索引，需要的 IO 次数更少。
        - 案例：大部分关系数据库的索引，如 MySQL、Oracle都是用 B+ 树来实现的。
    4. **跳表**
        - 支持快速添加、删除、查找数据。而且，我们通过灵活调整索引结点个数和数据个数间的比例，可以很好的平衡索引对内存的消耗及其查询效率。
        - 案例：Redis 中的有序集合，就是用跳表来构建的。
    5. **布隆过滤器**
        - 有一定的判错率。
            - 对于判定存在的数据，有可能不存在; 
            - 对于不存在的数据，那就肯定不存在。
        - 内存占用非常少。
2. 静态数据结构
    - 把数据的关键词抽取出来，组织成有序数组，然后利用二分查找算法来快速查找数据。
