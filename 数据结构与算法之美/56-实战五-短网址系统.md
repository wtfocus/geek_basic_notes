[toc]

## 56 | 算法实战（五）：如何用学过的数据结构和算法实现一个短网址系统？

### 短网址简介

1. 功能
	- 就是把原始的长网址**转化**成短网址。
	- 当用户点击短网址的时候，短网址服务会将浏览器**重定向**为原始网址。
2. 短网址对比图
	- ![img](imgs/1cedb2511ec220d90d9caf71ef6c7643.jpg)

### 如何通过哈希算法生成短网址？

1. **如何让短网址更短**？

	- 原始网址经过 **MurmurHash** 计算后，得到的哈希值就是 181338494。我们再拼上短网址服务的域名，就变成了最终的短网址 http://t.cn/181338494
	- 我们可以将 10 进制的哈希值，转化成更**高进制**的哈希值，这样哈希值就变短了。我们将 10 进制的哈希值转化成 62 进制。
		- ![img](imgs/15e486a7db8d56a7b1c5ecf873b477f8.jpg)

2. **如何解决哈希冲突问题？**

	- 我们将短网址与原始网址之间的对应关系，存储在 MySQL 数据库中。

	- 当拿到新生成的短网址后，先在 MySQL 数据库中查找

		> 没有找到相同的短网址，就说明没有冲突。
		>
		> 找到了相同的短网址，也并不一定说明就冲突了。再对比原始网址。

	- **不同**的原始网址，经过计算，得到的短网址**重复**了。这个时候，该怎么办？

		> 给原始网址拼接一串特殊字符，比如“[DUPLICATED]”，然后再重新计算哈希值。
		>
		> 极端的情况，又发生冲突了。我们可以再换一个拼接字符串，比如“[OHMYGOD]”，再计算哈希值。

3. **如何优化哈希算法生成短网址的性能？**

	- 添加 MySQL **唯一索引**，直接将生成的短网址与对应的原始网址，尝试存储到数据库中。减少查询步骤。
	- 借助**布隆过滤器**，把已经生成的短网址，构建成布隆过滤器。当有新的短网址生成的时候，先在布隆过滤器中查找。

### 如何通过 ID 生成器生成短网址？

1. **相同的原始网址可能会对应不同的短网址**
	- **不做处理**
	- 借助哈希算法生成短网址的处理思想，**先查数据库**。
2. **如何实现高性能的 ID 生成器？**
	- 给 ID 生成器装多个**前置发号器**。我们批量地给每个前置发号器发送 ID 号码。
		- ![img](imgs/8fde8862e17b1bdf7779f2b60b166335.jpg)
	- 直接实现**多个 ID 生成器**同时服务，每个 ID 生成器按照一定的规则，来生成 ID 号码。
		- ![img](imgs/bfeb7fc556b1fe5f9b768ce5ec90321a.jpg)